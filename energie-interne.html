<section id="arc">
<h2>DÃ©formation dâ€™un objet Ã©lastique : arc et flÃ¨che</h2>

<p>
Le travail exercÃ© par lâ€™archer sur lâ€™arc provoque sa dÃ©formation et le stockage
dâ€™Ã©nergie interne (Ã©nergie Ã©lastique), qui sera transfÃ©rÃ©e Ã  la flÃ¨che.
</p>

<div class="sim">

<canvas id="arcSim" width="600" height="300"></canvas>

<label>
Tension de lâ€™arc (travail appliquÃ©)
<input type="range" id="pull" min="0" max="100" value="0">
</label>

<p>
Ã‰nergie interne stockÃ©e :
<b><span id="Earc">0</span> J</b>
</p>

<button id="shootBtn">â–¶ Tirer</button>
<button id="pauseBtn">â¸ Pause</button>
<button id="resetBtn">ğŸ” Recommencer</button>

</div>

<script>
const canvas = document.getElementById("arcSim");
const ctx = canvas.getContext("2d");

let state = "idle"; // idle | flying | paused
let arrowX = 280;
let speed = 0;
let energy = 0;
let animationId = null;

function drawArcher(armBack){
  // tÃªte
  ctx.beginPath();
  ctx.arc(480,70,15,0,Math.PI*2);
  ctx.stroke();

  // corps
  ctx.beginPath();
  ctx.moveTo(480,85);
  ctx.lineTo(480,150);
  ctx.stroke();

  // jambe
  ctx.beginPath();
  ctx.moveTo(480,150);
  ctx.lineTo(460,200);
  ctx.lineTo(500,200);
  ctx.stroke();

  // bras avant (tenant lâ€™arc)
  ctx.beginPath();
  ctx.moveTo(480,100);
  ctx.lineTo(430,120);
  ctx.stroke();

  // bras arriÃ¨re (tirant la corde)
  ctx.beginPath();
  ctx.moveTo(480,100);
  ctx.lineTo(430-armBack,120);
  ctx.stroke();
}

function draw(bend){
  ctx.clearRect(0,0,600,300);

  // ARC
  ctx.beginPath();
  ctx.moveTo(150,40);
  ctx.quadraticCurveTo(150-bend,150,150,260);
  ctx.strokeStyle="brown";
  ctx.lineWidth=5;
  ctx.stroke();

  // CORDE
  ctx.beginPath();
  ctx.moveTo(150,40);
  ctx.lineTo(150+bend,150);
  ctx.lineTo(150,260);
  ctx.strokeStyle="black";
  ctx.lineWidth=2;
  ctx.stroke();

  // FLÃˆCHE
  ctx.fillStyle="black";
  ctx.fillRect(arrowX,145,80,6);
  ctx.beginPath();
  ctx.moveTo(arrowX+80,145);
  ctx.lineTo(arrowX+95,148);
  ctx.lineTo(arrowX+80,151);
  ctx.fill();

  // ARCHER
  drawArcher(bend*0.3);

  // BARRE Ã‰NERGIE
  ctx.fillStyle="#ddd";
  ctx.fillRect(380,260,150,15);
  ctx.fillStyle="#ff9800";
  ctx.fillRect(380,260,Math.min(energy,150),15);
  ctx.strokeRect(380,260,150,15);
  ctx.fillStyle="black";
  ctx.fillText("Ã‰nergie interne (arc)",380,255);
}

function updateIdle(){
  const p = pull.value;
  const bend = p * 0.6;
  energy = 0.02 * p * p;
  document.getElementById("Earc").innerText = energy.toFixed(1);
  arrowX = 150 + bend + 60;
  draw(bend);
}

pull.addEventListener("input", () => {
  if(state === "idle") updateIdle();
});

document.getElementById("shootBtn").onclick = () => {
  if(state !== "idle") return;
  state = "flying";
  speed = pull.value / 5;
  animate();
};

document.getElementById("pauseBtn").onclick = () => {
  if(state === "flying"){
    state = "paused";
  } else if(state === "paused"){
    state = "flying";
    animate();
  }
};

document.getElementById("resetBtn").onclick = () => {
  cancelAnimationFrame(animationId);
  state = "idle";
  pull.value = 0;
  energy = 0;
  document.getElementById("Earc").innerText = "0";
  arrowX = 280;
  updateIdle();
};

function animate(){
  if(state !== "flying") return;

  arrowX += speed;
  draw(0);

  if(arrowX < 600){
    animationId = requestAnimationFrame(animate);
  } else {
    state = "idle";
  }
}

// Initialisation
updateIdle();
</script>

<div class="box">
Lâ€™archer fournit un travail mÃ©canique en tirant la corde.
Ce travail est stockÃ© dans lâ€™arc sous forme dâ€™Ã©nergie interne Ã©lastique,
puis transfÃ©rÃ© Ã  la flÃ¨che sous forme dâ€™Ã©nergie cinÃ©tique.
</div>

</section>
