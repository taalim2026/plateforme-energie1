<section id="arc">
<h2>DÃ©formation dâ€™un objet Ã©lastique : arc et flÃ¨che</h2>

<p>
Le travail exercÃ© sur lâ€™arc provoque sa dÃ©formation et le stockage
dâ€™Ã©nergie interne (Ã©nergie Ã©lastique), qui peut Ãªtre restituÃ©e Ã  la flÃ¨che.
</p>

<div class="sim">

<canvas id="arcSim" width="520" height="260"></canvas>

<label>
Tension de lâ€™arc
<input type="range" id="pull" min="0" max="100" value="0">
</label>

<p>
Ã‰nergie interne stockÃ©e :
<b><span id="Earc">0</span> J</b>
</p>

<button id="shootBtn">â–¶ Tirer</button>
<button id="pauseBtn">â¸ Pause</button>
<button id="resetBtn">ğŸ” Recommencer</button>

</div>

<script>
const canvas = document.getElementById("arcSim");
const ctx = canvas.getContext("2d");

let state = "idle"; // idle | flying | paused
let arrowX = 260;
let speed = 0;
let energy = 0;
let animationId = null;

function draw(bend){
  ctx.clearRect(0,0,520,260);

  // ARC
  ctx.beginPath();
  ctx.moveTo(120,30);
  ctx.quadraticCurveTo(120-bend,130,120,230);
  ctx.strokeStyle="brown";
  ctx.lineWidth=5;
  ctx.stroke();

  // CORDE
  ctx.beginPath();
  ctx.moveTo(120,30);
  ctx.lineTo(120+bend,130);
  ctx.lineTo(120,230);
  ctx.strokeStyle="black";
  ctx.lineWidth=2;
  ctx.stroke();

  // FLÃˆCHE
  ctx.fillStyle="black";
  ctx.fillRect(arrowX,125,70,6);
  ctx.beginPath();
  ctx.moveTo(arrowX+70,125);
  ctx.lineTo(arrowX+85,128);
  ctx.lineTo(arrowX+70,131);
  ctx.fill();

  // BARRE Ã‰NERGIE
  ctx.fillStyle="#ddd";
  ctx.fillRect(360,200,120,15);
  ctx.fillStyle="#ff9800";
  ctx.fillRect(360,200,Math.min(energy,120),15);
  ctx.strokeRect(360,200,120,15);
  ctx.fillStyle="black";
  ctx.fillText("Ã‰nergie interne",360,195);
}

function updateIdle(){
  const p = pull.value;
  const bend = p * 0.6;
  energy = 0.02 * p * p;
  document.getElementById("Earc").innerText = energy.toFixed(1);
  arrowX = 120 + bend + 60;
  draw(bend);
}

pull.addEventListener("input", () => {
  if(state === "idle") updateIdle();
});

document.getElementById("shootBtn").onclick = () => {
  if(state !== "idle") return;
  state = "flying";
  speed = pull.value / 5;
  animate();
};

document.getElementById("pauseBtn").onclick = () => {
  if(state === "flying"){
    state = "paused";
  } else if(state === "paused"){
    state = "flying";
    animate();
  }
};

document.getElementById("resetBtn").onclick = () => {
  cancelAnimationFrame(animationId);
  state = "idle";
  pull.value = 0;
  energy = 0;
  document.getElementById("Earc").innerText = "0";
  arrowX = 260;
  updateIdle();
};

function animate(){
  if(state !== "flying") return;

  arrowX += speed;
  draw(0);

  if(arrowX < 520){
    animationId = requestAnimationFrame(animate);
  } else {
    state = "idle";
  }
}

// Initialisation
updateIdle();
</script>

<div class="box">
Le travail exercÃ© sur lâ€™arc est stockÃ© sous forme dâ€™Ã©nergie interne Ã©lastique.
Lors du tir, cette Ã©nergie est transfÃ©rÃ©e Ã  la flÃ¨che sous forme dâ€™Ã©nergie cinÃ©tique.
</div>

</section>
