<section id="arc">
<h2>DÃ©formation dâ€™un objet Ã©lastique : arc et flÃ¨che</h2>

<p>
Le travail exercÃ© par lâ€™archer sur la corde provoque la dÃ©formation de lâ€™arc.
Cette dÃ©formation modifie les interactions microscopiques entre les particules
de lâ€™arc et entraÃ®ne un stockage dâ€™Ã©nergie interne (Ã©nergie Ã©lastique).
</p>

<div class="sim">

<canvas id="arcSim" width="640" height="300"></canvas>

<label>
Tension de la corde (travail fourni)
<input type="range" id="pull" min="0" max="100" value="0">
</label>

<p>
Ã‰nergie interne stockÃ©e :
<b><span id="Earc">0</span> J</b>
</p>

<button id="shootBtn">â–¶ Tirer</button>
<button id="pauseBtn">â¸ Pause</button>
<button id="resetBtn">ğŸ” Recommencer</button>

</div>

<script>
const canvas = document.getElementById("arcSim");
const ctx = canvas.getContext("2d");

let state = "idle"; // idle | flying | paused
let arrowX = 300;
let speed = 0;
let energy = 0;
let animId = null;

// === DESSIN DE L'ARCHER (Ã€ GAUCHE) ===
function drawArcher(armBack){
  // tÃªte
  ctx.beginPath();
  ctx.arc(100,70,15,0,Math.PI*2);
  ctx.stroke();

  // corps
  ctx.beginPath();
  ctx.moveTo(100,85);
  ctx.lineTo(100,150);
  ctx.stroke();

  // jambes
  ctx.beginPath();
  ctx.moveTo(100,150);
  ctx.lineTo(80,210);
  ctx.lineTo(120,210);
  ctx.stroke();

  // bras avant (tenant lâ€™arc)
  ctx.beginPath();
  ctx.moveTo(100,100);
  ctx.lineTo(160,120);
  ctx.stroke();

  // bras arriÃ¨re (tirant la corde)
  ctx.beginPath();
  ctx.moveTo(100,100);
  ctx.lineTo(160-armBack,120);
  ctx.stroke();
}

// === DESSIN GLOBAL ===
function draw(bend){
  ctx.clearRect(0,0,640,300);

  // ARCHER
  drawArcher(bend*0.3);

  // ARC (au centre)
  ctx.beginPath();
  ctx.moveTo(260,40);
  ctx.quadraticCurveTo(260-bend,150,260,260);
  ctx.strokeStyle="brown";
  ctx.lineWidth=5;
  ctx.stroke();

  // CORDE
  ctx.beginPath();
  ctx.moveTo(260,40);
  ctx.lineTo(260+bend,150);
  ctx.lineTo(260,260);
  ctx.strokeStyle="black";
  ctx.lineWidth=2;
  ctx.stroke();

  // FLÃˆCHE (Ã  droite)
  ctx.fillStyle="black";
  ctx.fillRect(arrowX,145,80,6);
  ctx.beginPath();
  ctx.moveTo(arrowX+80,145);
  ctx.lineTo(arrowX+95,148);
  ctx.lineTo(arrowX+80,151);
  ctx.fill();

  // BARRE Ã‰NERGIE
  ctx.fillStyle="#ddd";
  ctx.fillRect(430,260,160,15);
  ctx.fillStyle="#ff9800";
  ctx.fillRect(430,260,Math.min(energy,160),15);
  ctx.strokeRect(430,260,160,15);
  ctx.fillStyle="black";
  ctx.fillText("Ã‰nergie interne (arc)",430,255);
}

// === Ã‰TAT AU REPOS ===
function updateIdle(){
  const p = pull.value;
  const bend = p * 0.7;
  energy = 0.02 * p * p;
  document.getElementById("Earc").innerText = energy.toFixed(1);
  arrowX = 260 + bend + 60;
  draw(bend);
}

pull.addEventListener("input", ()=>{
  if(state === "idle") updateIdle();
});

// === TIR ===
document.getElementById("shootBtn").onclick = ()=>{
  if(state !== "idle") return;
  state = "flying";
  speed = pull.value / 4;
  animate();
};

// === PAUSE ===
document.getElementById("pauseBtn").onclick = ()=>{
  if(state === "flying"){
    state = "paused";
  } else if(state === "paused"){
    state = "flying";
    animate();
  }
};

// === RESET ===
document.getElementById("resetBtn").onclick = ()=>{
  cancelAnimationFrame(animId);
  state = "idle";
  pull.value = 0;
  energy = 0;
  document.getElementById("Earc").innerText = "0";
  arrowX = 300;
  updateIdle();
};

// === ANIMATION ===
function animate(){
  if(state !== "flying") return;

  arrowX += speed;
  draw(0);

  if(arrowX < 640){
    animId = requestAnimationFrame(animate);
  } else {
    state = "idle";
  }
}

// INITIALISATION
updateIdle();
</script>

<div class="box">
Lâ€™archer fournit un travail mÃ©canique en tirant la corde vers lui.
Ce travail est stockÃ© dans lâ€™arc sous forme dâ€™Ã©nergie interne Ã©lastique,
puis transfÃ©rÃ© Ã  la flÃ¨che sous forme dâ€™Ã©nergie cinÃ©tique.
</div>

</section>
